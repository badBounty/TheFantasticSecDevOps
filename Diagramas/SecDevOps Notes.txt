Notas a tener en cuenta:

-No olvidarse que el repo dtv esta en la vm de jenkins y luego pasa al container SAST bajo el nombre TestJava
(en este caso).

docker run --volume SAST. Si falla el titleNormalization es 
porque cuando se borro un container quedo asociado un volumen.
Solucion: docker rm -v {containerID}. remueve el volumen asociado.
remover tambien los .log que utilice el run.

SonarQube server cannot be reached. -> verificar con curl y que el contenedor SAST este starteado.
(verificar firewall ubuntu). En caso de que no se haya iniciado el container verificar que no haya 
muchas imágenes previas de SAST. Eliminarlas y volver a buildear una sola vez. Configurar la key.

A veces puede pasar que se necesite hacer un script-approval en jenkins. 
Manage jenkins -> InProcess-ScriptApproval.

method groovy.json.JsonSlurperClassic parseText java.lang.String
method java.lang.Throwable printStackTrace
new groovy.json.JsonSlurperClassic

---------------------------------------------------------------------------------------------------

RegexScanner:

(Verificar que al correr la imagen de docker de SAST se añada vulRegexScanner.py con errors='ignore').
No se añade. Verificar por que se añade la versión anterior. (era porque la imagen ya buildeada tenia una
version anterior del regexscanner).

Verificar que aunque se ignoren los errores no deje el result vacio.

Error - Message: Error on internal block - Expresion:Potentially sensitive information exposed in logs - Archivo:/home/TestJava/ott-site/core/src/test/resources/com/ott/core/controllers/welcomesection/WelcomeSectionUseTest.json - Stacktrace:Traceback (most recent call last):
  File "/home/vulRegexScanner.py", line 98, in <module>
    for line in codecs.open(fullPathFile, 'r', encoding='utf-8'):
  File "/usr/lib/python3.9/codecs.py", line 714, in __next__
    return next(self.reader)
  File "/usr/lib/python3.9/codecs.py", line 645, in __next__
    line = self.readline()
  File "/usr/lib/python3.9/codecs.py", line 558, in readline
    data = self.read(readsize, firstline=True)
  File "/usr/lib/python3.9/codecs.py", line 504, in read
    newchars, decodedbytes = self.decode(data, self.errors)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xd3 in position 8: invalid continuation byte

------------------------------------------------------------------------------------------------

Error de python al hacer un decode del json. Asumo que es porque esta vacio o esta mal ubicado.
Preguntar bien sobre ese json, como se rellena o como deberia ser (settings.json). 
Verificar el comando docker run de orch.

Traceback (most recent call last):
  File "manage.py", line 21, in <module>
    main()
  File "manage.py", line 17, in main
    execute_from_command_line(sys.argv)
  File "/usr/local/lib/python3.8/dist-packages/django/core/management/__init__.py", line 401, in execute_from_command_line
    utility.execute()
  File "/usr/local/lib/python3.8/dist-packages/django/core/management/__init__.py", line 345, in execute
    settings.INSTALLED_APPS
  File "/usr/local/lib/python3.8/dist-packages/django/conf/__init__.py", line 76, in __getattr__
    self._setup(name)
  File "/usr/local/lib/python3.8/dist-packages/django/conf/__init__.py", line 63, in _setup
    self._wrapped = Settings(settings_module)
  File "/usr/local/lib/python3.8/dist-packages/django/conf/__init__.py", line 142, in __init__
    mod = importlib.import_module(self.SETTINGS_MODULE)
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 961, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 783, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/__init__.py", line 1, in <module>
    from VM_Orchestrator.celery import app as celery_app
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/celery.py", line 7, in <module>
    from VM_OrchestratorApp import settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_OrchestratorApp/__init__.py", line 2, in <module>
    from VM_Orchestrator.settings import MONGO_INFO, settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/settings.py", line 23, in <module>
    settings = json.loads(open(BASE_DIR+'/settings.json').read())
  File "/usr/lib/python3.8/json/__init__.py", line 357, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python3.8/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python3.8/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/kombu/utils/imports.py", line 57, in symbol_by_name
    module = imp(module_name, package=package, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/celery/utils/imports.py", line 111, in import_from_cwd
    return imp(module, package=package)
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 783, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/__init__.py", line 1, in <module>
    from VM_Orchestrator.celery import app as celery_app
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/celery.py", line 7, in <module>
    from VM_OrchestratorApp import settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_OrchestratorApp/__init__.py", line 2, in <module>
    from VM_Orchestrator.settings import MONGO_INFO, settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/settings.py", line 23, in <module>
    settings = json.loads(open(BASE_DIR+'/settings.json').read())
  File "/usr/lib/python3.8/json/__init__.py", line 357, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python3.8/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python3.8/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/bin/celery", line 8, in <module>
    sys.exit(main())
  File "/usr/local/lib/python3.8/dist-packages/celery/__main__.py", line 16, in main
    _main()
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/celery.py", line 322, in main
    cmd.execute_from_commandline(argv)
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/celery.py", line 495, in execute_from_commandline
    super(CeleryCommand, self).execute_from_commandline(argv)))
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/base.py", line 289, in execute_from_commandline
    argv = self.setup_app_from_commandline(argv)
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/base.py", line 509, in setup_app_from_commandline
    self.app = self.find_app(app)
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/base.py", line 531, in find_app
    return find_app(app, symbol_by_name=self.symbol_by_name)
  File "/usr/local/lib/python3.8/dist-packages/celery/app/utils.py", line 373, in find_app
    sym = symbol_by_name(app, imp=imp)
  File "/usr/local/lib/python3.8/dist-packages/celery/bin/base.py", line 534, in symbol_by_name
    return imports.symbol_by_name(name, imp=imp)
  File "/usr/local/lib/python3.8/dist-packages/kombu/utils/imports.py", line 59, in symbol_by_name
    reraise(ValueError,
  File "/usr/local/lib/python3.8/dist-packages/vine/five.py", line 194, in reraise
    raise value.with_traceback(tb)
  File "/usr/local/lib/python3.8/dist-packages/kombu/utils/imports.py", line 57, in symbol_by_name
    module = imp(module_name, package=package, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/celery/utils/imports.py", line 111, in import_from_cwd
    return imp(module, package=package)
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 783, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/__init__.py", line 1, in <module>
    from VM_Orchestrator.celery import app as celery_app
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/celery.py", line 7, in <module>
    from VM_OrchestratorApp import settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_OrchestratorApp/__init__.py", line 2, in <module>
    from VM_Orchestrator.settings import MONGO_INFO, settings
  File "/VM-Orchestrator-project/VM-Orchestrator/VM_Orchestrator/VM_Orchestrator/settings.py", line 23, in <module>
    settings = json.loads(open(BASE_DIR+'/settings.json').read())
  File "/usr/lib/python3.8/json/__init__.py", line 357, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python3.8/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python3.8/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
ValueError: Couldn't import 'VM_Orchestrator': Expecting value: line 1 column 1 (char 0)

Solucion -> El path estaba mal en el run de la image. Del lado izquierdo va host y del derecho container.
La solucion en mi caso fue "/home/ubuntu/etc.../settings.json:/VM-Orchestrator-project/etc.../settings.json.
A tener en cuenta: Llenar settings.json con settings-example.json.

------------------------------------------------------------------------------------------------------------

Datos para settings.json:

Celery Broker url:
amqp://<USERNAME>:<PASSWORD>@localhost:5672/<VHOST>

Elastic:
127.0.0.1 (si no anda la solucion es la ip privada de la vm).

Redmine:

http://127.0.0.1:3000 (si no anda la solucion es la ip privada de la vm).
{Credenciales}

Project Name -> crear projecto en redmine.

Borrar paths de ftp etc.

Revisar firewall de aws. Por que no se puede conectar a la vm orch.
Solución: Abrir puertos de aws. Desde jenkins en pipeline conectarse con la ip PUBLICA. 
La privada no la toma. Estimo que es porque está en otra red diferente a la de jenkins y sast.

--------------------------------------------------------------------------------------------
DisallowedHost at /rcv_code_vulnerability_state/
Invalid HTTP_HOST header: '{IP_PUBLICA}:4000'. You may need to add '{IP_PUBLICA}' to ALLOWED_HOSTS.

Solución: Agregar la ip PUBLICA a allowed hosts en settings.json dentro del container de orch.
(Junto con localhost y 127.0.0.1). También agregar al pipeline en las URLs

Nota: Entre cada pipeline ejecutado es conveniendo eliminar el container SAST junto con el vol asociado.
docker rm -v {containerID}. De esta forma se corre en limpio el proceso de creación del container.
Una vez asegurado el proceso y todo funciona correcto, HABILITAR el stage de SAST-Destroy para eliminar
el container y liberar recursos.

En caso de no poder acceder a un recurso como /web/vulnerabilities/ y que devuelva un
Errno 111 Connection Refused probar la ip PRIVADA (funcionó). 

A python no le suele gustar "localhost" se ve.

-------------------------------------------------------------------------------------------------------

Error al hacer POST en PostResults. El response queda null.
El problema era el POST que no se hacía a vm orch. La solución fue ponerle http:// a las url,
y que no arranque unicamente con la ip.